<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniNotes AI - Intelligent Note Generation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');
        
        @font-face {
            font-family: 'Geist';
            src: url('https://assets.vercel.com/font/Geist/GeistVariableVF.woff2') format('woff2');
            font-weight: 100 900;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Geist Mono';
            src: url('https://assets.vercel.com/font/GeistMono/GeistMonoVariableVF.woff2') format('woff2');
            font-weight: 100 900;
            font-display: swap;
        }

        :root {
            --background: 0 0% 100%;
            --foreground: 240 10% 3.9%;
            --card: 0 0% 100%;
            --card-foreground: 240 10% 3.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 240 10% 3.9%;
            --primary: 240 5.9% 10%;
            --primary-foreground: 0 0% 98%;
            --secondary: 240 4.8% 95.9%;
            --secondary-foreground: 240 5.9% 10%;
            --muted: 240 4.8% 95.9%;
            --muted-foreground: 240 3.8% 46.1%;
            --accent: 240 4.8% 95.9%;
            --accent-foreground: 240 5.9% 10%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 0 0% 98%;
            --border: 240 5.9% 90%;
            --input: 240 5.9% 90%;
            --ring: 240 5.9% 10%;
            --radius: 0.75rem;
            --chart-1: 12 76% 61%;
            --chart-2: 173 58% 39%;
            --chart-3: 197 37% 24%;
            --chart-4: 43 74% 66%;
            --chart-5: 27 87% 67%;
        }

        .dark {
            --background: 240 10% 3.9%;
            --foreground: 0 0% 98%;
            --card: 240 10% 3.9%;
            --card-foreground: 0 0% 98%;
            --popover: 240 10% 3.9%;
            --popover-foreground: 0 0% 98%;
            --primary: 0 0% 98%;
            --primary-foreground: 240 5.9% 10%;
            --secondary: 240 3.7% 15.9%;
            --secondary-foreground: 0 0% 98%;
            --muted: 240 3.7% 15.9%;
            --muted-foreground: 240 5% 64.9%;
            --accent: 240 3.7% 15.9%;
            --accent-foreground: 0 0% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 0 0% 98%;
            --border: 240 3.7% 15.9%;
            --input: 240 3.7% 15.9%;
            --ring: 240 4.9% 83.9%;
            --chart-1: 220 70% 50%;
            --chart-2: 160 60% 45%;
            --chart-3: 30 80% 55%;
            --chart-4: 280 65% 60%;
            --chart-5: 340 75% 55%;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            border-color: hsl(var(--border));
        }

        body {
            font-family: 'Geist', 'Inter', system-ui, sans-serif;
            background: hsl(var(--background));
            color: hsl(var(--foreground));
            min-height: 100vh;
            line-height: 1.5;
            transition: background-color 0.3s ease, color 0.3s ease;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .font-mono {
            font-family: 'Geist Mono', 'JetBrains Mono', ui-monospace, monospace;
        }

        /* Grain texture overlay */
        .bg-grain {
            position: fixed;
            inset: 0;
            z-index: -1;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            pointer-events: none;
        }

        /* Aurora gradient background */
        .bg-aurora {
            position: fixed;
            inset: 0;
            z-index: -2;
            background: 
                radial-gradient(circle at 0% 0%, hsl(var(--primary) / 0.15) 0%, transparent 50%),
                radial-gradient(circle at 100% 0%, hsl(var(--accent) / 0.1) 0%, transparent 50%),
                radial-gradient(circle at 100% 100%, hsl(var(--secondary) / 0.08) 0%, transparent 40%),
                hsl(var(--background));
            animation: aurora 20s ease-in-out infinite;
        }

        @keyframes aurora {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }

        /* Shadcn UI Component Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border-radius: calc(var(--radius) - 2px);
            font-size: 0.875rem;
            font-weight: 500;
            line-height: 1.25rem;
            height: 2.5rem;
            padding: 0.5rem 1rem;
            transition: all 0.2s ease;
            cursor: pointer;
            outline: none;
            border: 1px solid transparent;
            white-space: nowrap;
            font-family: inherit;
        }

        .btn:focus-visible {
            outline: none;
            box-shadow: 0 0 0 2px hsl(var(--background)), 0 0 0 4px hsl(var(--ring));
        }

        .btn-default {
            background: hsl(var(--primary));
            color: hsl(var(--primary-foreground));
        }

        .btn-default:hover {
            background: hsl(var(--primary) / 0.9);
        }

        .btn-secondary {
            background: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
        }

        .btn-secondary:hover {
            background: hsl(var(--secondary) / 0.8);
        }

        .btn-outline {
            background: transparent;
            border-color: hsl(var(--border));
            color: hsl(var(--foreground));
        }

        .btn-outline:hover {
            background: hsl(var(--accent));
            color: hsl(var(--accent-foreground));
        }

        .btn-ghost {
            background: transparent;
            color: hsl(var(--foreground));
        }

        .btn-ghost:hover {
            background: hsl(var(--accent));
        }

        .btn-sm {
            height: 2.25rem;
            padding: 0 0.75rem;
            font-size: 0.8125rem;
        }

        .btn-lg {
            height: 2.75rem;
            padding: 0 2rem;
        }

        .btn:disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        /* Card */
        .card {
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.15);
            border-color: hsl(var(--muted-foreground) / 0.3);
            transform: translateY(-2px);
        }

        .dark .card {
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .dark .card-hover:hover {
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
            border-color: hsl(var(--muted-foreground) / 0.2);
        }

        /* Input/Textarea */
        .textarea-shadcn {
            width: 100%;
            min-height: 100%;
            background: transparent;
            border: none;
            color: hsl(var(--foreground));
            font-family: 'Geist Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.7;
            resize: none;
            outline: none;
            padding: 1.5rem;
        }

        .textarea-shadcn::placeholder {
            color: hsl(var(--muted-foreground));
        }

        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            border-radius: 9999px;
            border: 1px solid transparent;
            padding: 0.125rem 0.625rem;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .badge-secondary {
            background: hsl(var(--secondary));
            color: hsl(var(--secondary-foreground));
            border-color: hsl(var(--border));
        }

        /* Drop Zone */
        .drop-zone {
            border: 2px dashed hsl(var(--border));
            border-radius: calc(var(--radius) - 2px);
            background: hsl(var(--muted) / 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .drop-zone::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, hsl(var(--primary) / 0.05), hsl(var(--secondary) / 0.05));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .drop-zone:hover, .drop-zone.dragover {
            border-color: hsl(var(--primary));
            background: hsl(var(--muted) / 0.5);
            transform: scale(1.01);
        }

        .drop-zone:hover::before, .drop-zone.dragover::before {
            opacity: 1;
        }

        .drop-zone.dragover {
            animation: border-pulse 2s infinite;
        }

        @keyframes border-pulse {
            0%, 100% { border-color: hsl(var(--primary)); }
            50% { border-color: hsl(var(--primary) / 0.5); }
        }

        /* Animations */
        .animate-in {
            animation: animate-in 0.4s ease-out;
        }

        @keyframes animate-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slide-in 0.5s ease-out;
        }

        @keyframes slide-in {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Toggle Switch */
        .theme-toggle {
            position: relative;
            width: 44px;
            height: 24px;
            background: hsl(var(--muted));
            border-radius: 9999px;
            cursor: pointer;
            transition: background 0.3s;
            border: 1px solid hsl(var(--border));
        }

        .theme-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: hsl(var(--background));
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dark .theme-toggle::after {
            transform: translateX(20px);
            background: hsl(var(--foreground));
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: hsl(var(--muted));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: hsl(var(--muted-foreground));
        }

        /* Preview markdown styles */
        .preview-content h1 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: hsl(var(--foreground));
            font-family: 'Geist', sans-serif;
            letter-spacing: -0.02em;
        }

        .preview-content h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 2rem;
            margin-bottom: 0.75rem;
            color: hsl(var(--foreground));
            font-family: 'Geist', sans-serif;
            letter-spacing: -0.01em;
        }

        .preview-content h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: hsl(var(--foreground));
        }

        .preview-content strong {
            color: hsl(var(--primary));
            font-weight: 600;
            background: hsl(var(--primary) / 0.1);
            padding: 0.125rem 0.375rem;
            border-radius: 4px;
            font-size: 0.95em;
        }

        .preview-content ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .preview-content li {
            margin-bottom: 0.5rem;
            color: hsl(var(--foreground) / 0.9);
        }

        .preview-content blockquote {
            border-left: 3px solid hsl(var(--primary));
            padding-left: 1rem;
            color: hsl(var(--muted-foreground));
            font-style: italic;
            margin: 1rem 0;
        }

        .preview-content hr {
            border: none;
            border-top: 1px solid hsl(var(--border));
            margin: 2rem 0;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            z-index: 9999;
            animation: toast-in 0.3s ease-out;
            max-width: 400px;
        }

        @keyframes toast-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.hiding {
            animation: toast-out 0.3s ease-in forwards;
        }

        @keyframes toast-out {
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Progress bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: hsl(var(--muted));
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: hsl(var(--primary));
            transition: width 0.3s ease;
        }

        /* Custom scrollbar for panels */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: hsl(var(--border));
            border-radius: 3px;
        }

        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: hsl(var(--muted-foreground));
        }
    </style>
</head>
<body class="antialiased">
    <div class="bg-aurora"></div>
    <div class="bg-grain"></div>

    <div id="toast" class="hidden toast">
        <div id="toastIcon" class="flex-shrink-0"></div>
        <div>
            <h4 id="toastTitle" class="font-medium text-sm">Notification</h4>
            <p id="toastMessage" class="text-sm text-muted-foreground text-[hsl(var(--muted-foreground))] mt-0.5"></p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 border-b border-[hsl(var(--border))] bg-[hsl(var(--background))]/80 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex h-16 items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-[hsl(var(--primary))] text-[hsl(var(--primary-foreground))] flex items-center justify-center font-bold text-lg shadow-lg">
                        <i data-lucide="graduation-cap" class="w-5 h-5"></i>
                    </div>
                    <span class="font-bold text-xl tracking-tight">UniNotes AI</span>
                </div>
                
                <div class="flex items-center gap-4">
                    <button onclick="toggleTheme()" class="theme-toggle" aria-label="Toggle theme">
                        <div class="absolute inset-0 flex items-center justify-between px-1.5 text-[10px] pointer-events-none">
                            <i data-lucide="moon" class="w-3 h-3 text-[hsl(var(--muted-foreground))] dark:text-transparent"></i>
                            <i data-lucide="sun" class="w-3 h-3 text-transparent dark:text-[hsl(var(--muted-foreground))]"></i>
                        </div>
                    </button>
                    <button class="btn btn-ghost btn-sm">
                        <i data-lucide="help-circle" class="w-4 h-4 mr-2"></i>
                        Help
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-12">
        
        <!-- Upload Section -->
        <div id="uploadSection" class="max-w-3xl mx-auto animate-in">
            <div class="text-center mb-10">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[hsl(var(--primary))]/10 text-[hsl(var(--primary))] text-xs font-semibold mb-6 border border-[hsl(var(--primary))]/20">
                    <span class="relative flex h-2 w-2">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-[hsl(var(--primary))] opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-[hsl(var(--primary))]"></span>
                    </span>
                    Now with real file parsing
                </div>
                
                <h1 class="text-5xl md:text-6xl font-bold tracking-tight mb-4 text-[hsl(var(--foreground))]">
                    Transform Lectures into<br>
                    <span class="relative inline-block">
                        <span class="relative z-10 bg-gradient-to-r from-[hsl(var(--primary))] to-[hsl(var(--primary))]/50 bg-clip-text text-transparent">Structured Knowledge</span>
                        <svg class="absolute -bottom-2 left-0 w-full h-3 text-[hsl(var(--primary))]/20 -z-0" viewBox="0 0 100 10" preserveAspectRatio="none">
                            <path d="M0 5 Q 50 10 100 5" stroke="currentColor" stroke-width="8" fill="none" />
                        </svg>
                    </span>
                </h1>
                
                <p class="text-lg text-[hsl(var(--muted-foreground))] max-w-2xl mx-auto leading-relaxed">
                    Upload your lecture slides (PDF, PPTX, DOCX) and instantly extract content 
                    to generate comprehensive, exam-ready notes using AI.
                </p>
            </div>

            <div class="card card-hover p-1">
                <div class="p-6 md:p-8">
                    <div id="dropZone" class="drop-zone p-10 md:p-16 cursor-pointer group">
                        <input type="file" id="fileInput" accept=".pdf,.pptx,.docx" class="hidden">
                        
                        <div class="flex flex-col items-center text-center space-y-4">
                            <div class="w-20 h-20 rounded-2xl bg-[hsl(var(--muted))] flex items-center justify-center group-hover:scale-110 transition-transform duration-300 shadow-inner">
                                <i data-lucide="upload-cloud" class="w-10 h-10 text-[hsl(var(--muted-foreground))]"></i>
                            </div>
                            
                            <div>
                                <h3 class="text-xl font-semibold mb-1 text-[hsl(var(--foreground))]">Drop your files here</h3>
                                <p class="text-sm text-[hsl(var(--muted-foreground))]">Supports PDF, PowerPoint, and Word documents up to 50MB</p>
                            </div>
                            
                            <div class="flex flex-wrap items-center justify-center gap-2 pt-2">
                                <span class="badge badge-secondary">
                                    <i data-lucide="file-text" class="w-3 h-3 mr-1"></i> PDF
                                </span>
                                <span class="badge badge-secondary">
                                    <i data-lucide="presentation" class="w-3 h-3 mr-1"></i> PPTX
                                </span>
                                <span class="badge badge-secondary">
                                    <i data-lucide="file-type" class="w-3 h-3 mr-1"></i> DOCX
                                </span>
                            </div>
                        </div>

                        <div id="extractionLog" class="hidden mt-6 p-4 rounded-md bg-[hsl(var(--muted))] font-mono text-xs text-[hsl(var(--muted-foreground))] space-y-1 max-h-40 overflow-y-auto custom-scroll text-left border border-[hsl(var(--border))]"></div>
                    </div>
                </div>
            </div>

            <!-- Features -->
            <div class="grid md:grid-cols-3 gap-4 mt-8">
                <div class="card card-hover p-6 animate-in" style="animation-delay: 0.1s">
                    <div class="w-10 h-10 rounded-xl bg-[hsl(var(--primary))]/10 flex items-center justify-center mb-4 text-[hsl(var(--primary))]">
                        <i data-lucide="shield-check" class="w-5 h-5"></i>
                    </div>
                    <h3 class="font-semibold mb-1">Client-Side Only</h3>
                    <p class="text-sm text-[hsl(var(--muted-foreground))]">Files processed locally in browser. No cloud uploads or data sharing.</p>
                </div>
                
                <div class="card card-hover p-6 animate-in" style="animation-delay: 0.2s">
                    <div class="w-10 h-10 rounded-xl bg-[hsl(var(--primary))]/10 flex items-center justify-center mb-4 text-[hsl(var(--primary))]">
                        <i data-lucide="brain" class="w-5 h-5"></i>
                    </div>
                    <h3 class="font-semibold mb-1">Smart Analysis</h3>
                    <p class="text-sm text-[hsl(var(--muted-foreground))]">Intelligent extraction preserving hierarchy and identifying key terms.</p>
                </div>
                
                <div class="card card-hover p-6 animate-in" style="animation-delay: 0.3s">
                    <div class="w-10 h-10 rounded-xl bg-[hsl(var(--primary))]/10 flex items-center justify-center mb-4 text-[hsl(var(--primary))]">
                        <i data-lucide="zap" class="w-5 h-5"></i>
                    </div>
                    <h3 class="font-semibold mb-1">Instant Export</h3>
                    <p class="text-sm text-[hsl(var(--muted-foreground))]">Generate Markdown or PDF notes immediately after processing.</p>
                </div>
            </div>
        </div>

        <!-- Workspace -->
        <div id="workspace" class="hidden animate-in">
            <!-- Toolbar -->
            <div class="card p-4 mb-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                <div class="flex items-center gap-4">
                    <div id="fileIcon" class="w-12 h-12 rounded-xl bg-[hsl(var(--muted))] flex items-center justify-center text-[hsl(var(--foreground))] shadow-sm">
                        <i data-lucide="file" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <h3 id="fileName" class="font-semibold text-[hsl(var(--foreground))]">document.pdf</h3>
                        <div class="flex items-center gap-2 mt-0.5">
                            <span id="contentStats" class="text-xs text-[hsl(var(--muted-foreground))]">0 pages</span>
                            <span id="fileBadge" class="badge badge-secondary">PDF</span>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center gap-2 w-full sm:w-auto">
                    <button onclick="resetApp()" class="btn btn-outline btn-sm flex-1 sm:flex-none">
                        <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                        New
                    </button>
                    <button onclick="generateNotes()" id="generateBtn" class="btn btn-default btn-sm flex-1 sm:flex-none shadow-lg shadow-[hsl(var(--primary))]/20">
                        <i data-lucide="sparkles" class="w-4 h-4 mr-2"></i>
                        Generate Notes
                    </button>
                </div>
            </div>

            <!-- Grid -->
            <div class="grid lg:grid-cols-[380px_1fr] gap-6 h-[calc(100vh-280px)] min-h-[600px]">
                
                <!-- Left Panel: Slides -->
                <div class="card flex flex-col overflow-hidden">
                    <div class="p-4 border-b border-[hsl(var(--border))] flex items-center justify-between bg-[hsl(var(--card))]">
                        <div class="flex items-center gap-2">
                            <i data-lucide="bookmark" class="w-4 h-4 text-[hsl(var(--primary))]"></i>
                            <span id="slidesTitle" class="font-semibold text-sm">Pages</span>
                            <span id="slideCountBadge" class="badge badge-secondary text-[10px]">0</span>
                        </div>
                        <button onclick="togglePanel(this)" class="p-1.5 hover:bg-[hsl(var(--muted))] rounded-md transition-colors">
                            <i data-lucide="chevron-down" class="w-4 h-4 text-[hsl(var(--muted-foreground))]"></i>
                        </button>
                    </div>
                    
                    <div class="flex-1 overflow-y-auto custom-scroll p-3 space-y-2" id="slidesList">
                        <!-- Slide items injected here -->
                    </div>
                </div>

                <!-- Right Panel: Editor -->
                <div class="card flex flex-col overflow-hidden relative">
                    <!-- Status Bar -->
                    <div id="statusBar" class="absolute top-0 left-0 right-0 bg-[hsl(var(--primary))] text-[hsl(var(--primary-foreground))] px-4 py-2 flex items-center justify-center gap-3 z-20 transform -translate-y-full transition-transform duration-300">
                        <div class="flex gap-1">
                            <span class="w-2 h-2 bg-current rounded-full animate-bounce"></span>
                            <span class="w-2 h-2 bg-current rounded-full animate-bounce" style="animation-delay: 0.1s"></span>
                            <span class="w-2 h-2 bg-current rounded-full animate-bounce" style="animation-delay: 0.2s"></span>
                        </div>
                        <span class="text-sm font-medium">Generating structured notes...</span>
                    </div>

                    <!-- Loading Overlay -->
                    <div id="editorLoading" class="hidden absolute inset-0 bg-[hsl(var(--background))]/95 backdrop-blur-sm z-30 flex flex-col items-center justify-center gap-4">
                        <div class="w-10 h-10 border-2 border-[hsl(var(--border))] border-t-[hsl(var(--primary))] rounded-full animate-spin"></div>
                        <div class="w-64 progress-bar">
                            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <p class="text-sm text-[hsl(var(--muted-foreground))]">Processing content...</p>
                    </div>

                    <div class="p-4 border-b border-[hsl(var(--border))] flex items-center justify-between bg-[hsl(var(--card))]">
                        <div class="flex items-center gap-2">
                            <i data-lucide="pen-tool" class="w-4 h-4 text-[hsl(var(--muted-foreground))]"></i>
                            <span class="font-semibold text-sm">Generated Notes</span>
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <div class="bg-[hsl(var(--muted))] p-1 rounded-lg flex items-center">
                                <button onclick="setMode('edit')" id="editBtn" class="px-3 py-1.5 rounded-md text-xs font-medium transition-all bg-[hsl(var(--background))] shadow-sm">
                                    Edit
                                </button>
                                <button onclick="setMode('preview')" id="previewBtn" class="px-3 py-1.5 rounded-md text-xs font-medium transition-all text-[hsl(var(--muted-foreground))] hover:text-[hsl(var(--foreground))]">
                                    Preview
                                </button>
                            </div>
                            <button onclick="copyContent()" class="p-2 hover:bg-[hsl(var(--muted))] rounded-md transition-colors text-[hsl(var(--muted-foreground))]">
                                <i data-lucide="copy" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>

                    <div class="flex-1 overflow-hidden relative bg-[hsl(var(--muted))]/30">
                        <textarea id="notesEditor" class="textarea-shadcn custom-scroll" placeholder="Click 'Generate Notes' to transform your content into structured study materials..."></textarea>
                        <div id="notesPreview" class="hidden absolute inset-0 overflow-y-auto custom-scroll p-6 preview-content text-[hsl(var(--foreground))]"></div>
                    </div>

                    <div class="p-4 border-t border-[hsl(var(--border))] flex items-center justify-between bg-[hsl(var(--card))]">
                        <span id="wordCount" class="text-xs text-[hsl(var(--muted-foreground))] flex items-center gap-2">
                            <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                            0 words
                        </span>
                        <div class="flex items-center gap-2">
                            <button onclick="downloadMarkdown()" class="btn btn-outline btn-sm">
                                <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                                Markdown
                            </button>
                            <button onclick="downloadPDF()" id="downloadBtn" class="btn btn-default btn-sm opacity-50 cursor-not-allowed" disabled>
                                <i data-lucide="file-text" class="w-4 h-4 mr-2"></i>
                                Export PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        let slidesData = [];
        let currentFileType = 'document';
        let originalFileName = '';

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Theme Toggle
        function toggleTheme() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
            lucide.createIcons();
        }

        // Load saved theme
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        // File Handling
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const extractionLog = document.getElementById('extractionLog');

        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) handleFile(e.target.files[0]);
        });

        function logExtraction(message) {
            extractionLog.classList.remove('hidden');
            const div = document.createElement('div');
            div.textContent = `> ${message}`;
            div.className = 'opacity-0 animate-in';
            extractionLog.appendChild(div);
            extractionLog.scrollTop = extractionLog.scrollHeight;
        }

        async function handleFile(file) {
            if (!['application/pdf', 'application/vnd.openxmlformats-officedocument.presentationml.presentation', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'].includes(file.type)) {
                showToast('Invalid file type', 'Please upload PDF, PPTX, or DOCX files only.', 'error');
                return;
            }

            originalFileName = file.name;
            logExtraction(`Loading ${file.name}...`);

            try {
                let content = [];
                if (file.type === 'application/pdf') {
                    content = await parsePDF(file);
                    currentFileType = 'pdf';
                } else if (file.type.includes('presentationml')) {
                    content = await parsePPTX(file);
                    currentFileType = 'slides';
                } else {
                    content = await parseDOCX(file);
                    currentFileType = 'doc';
                }

                if (content.length === 0) throw new Error('No text content found');

                slidesData = content.map((text, idx) => ({
                    number: idx + 1,
                    title: extractTitle(text),
                    content: text
                }));

                document.getElementById('uploadSection').classList.add('hidden');
                document.getElementById('workspace').classList.remove('hidden');
                
                document.getElementById('fileName').textContent = file.name;
                updateFileAppearance();
                renderSlidesList();
                
                showToast('Success', `Extracted ${slidesData.length} sections from document`, 'success');
                
            } catch (error) {
                showToast('Extraction Error', error.message, 'error');
                logExtraction(`Error: ${error.message}`);
            }
        }

        async function parsePDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            const slides = [];
            
            logExtraction(`PDF loaded: ${pdf.numPages} pages`);
            
            for (let i = 1; i <= pdf.numPages; i++) {
                logExtraction(`Extracting page ${i}/${pdf.numPages}...`);
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const text = textContent.items.map(item => item.str).join(' ');
                if (text.trim()) slides.push(text);
                document.getElementById('progressFill').style.width = `${(i/pdf.numPages)*100}%`;
            }
            return slides;
        }

        async function parsePPTX(file) {
            const arrayBuffer = await file.arrayBuffer();
            const zip = await JSZip.loadAsync(arrayBuffer);
            const slideFiles = Object.keys(zip.files)
                .filter(name => name.match(/ppt\/slides\/slide\d+\.xml/))
                .sort((a, b) => parseInt(a.match(/\d+/)[0]) - parseInt(b.match(/\d+/)[0]));
            
            logExtraction(`PPTX loaded: ${slideFiles.length} slides`);
            
            const slides = [];
            for (let i = 0; i < slideFiles.length; i++) {
                logExtraction(`Extracting slide ${i + 1}...`);
                const content = await zip.files[slideFiles[i]].async('text');
                const text = extractTextFromXML(content);
                if (text.trim()) slides.push(text);
                document.getElementById('progressFill').style.width = `${((i+1)/slideFiles.length)*100}%`;
            }
            return slides;
        }

        async function parseDOCX(file) {
            const arrayBuffer = await file.arrayBuffer();
            logExtraction('DOCX loaded, extracting text...');
            const result = await mammoth.extractRawText({ arrayBuffer });
            const paragraphs = result.value.split(/\n\n+/).filter(p => p.trim());
            logExtraction(`Extracted ${paragraphs.length} paragraphs`);
            return paragraphs;
        }

        function extractTextFromXML(xmlString) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlString, 'text/xml');
            const textElements = xmlDoc.getElementsByTagName('a:t');
            return Array.from(textElements).map(elem => elem.textContent).join(' ');
        }

        function extractTitle(text) {
            const sentences = text.match(/[^.!?]+[.!?]+/g) || [text];
            const first = sentences[0].trim();
            if (first.length < 100 && first.length > 5) return first.replace(/[.!?]$/, '');
            return text.split(' ').slice(0, 6).join(' ') + '...';
        }

        function updateFileAppearance() {
            const icons = {
                slides: 'presentation',
                pdf: 'file-text',
                doc: 'file-type'
            };
            const labels = { slides: 'PowerPoint', pdf: 'PDF', doc: 'Word' };
            const units = { slides: 'slides', pdf: 'pages', doc: 'sections' };
            
            document.getElementById('fileIcon').innerHTML = `<i data-lucide="${icons[currentFileType]}" class="w-6 h-6"></i>`;
            document.getElementById('fileBadge').textContent = labels[currentFileType];
            document.getElementById('contentStats').textContent = `${slidesData.length} ${units[currentFileType]}`;
            document.getElementById('slidesTitle').textContent = currentFileType === 'slides' ? 'Slides' : (currentFileType === 'pdf' ? 'Pages' : 'Sections');
            document.getElementById('slideCountBadge').textContent = slidesData.length;
            
            lucide.createIcons();
        }

        function renderSlidesList() {
            const container = document.getElementById('slidesList');
            container.innerHTML = slidesData.map((slide, idx) => `
                <div onclick="selectSlide(${idx})" class="slide-item cursor-pointer p-3 rounded-lg border border-[hsl(var(--border))] hover:bg-[hsl(var(--muted))] hover:border-[hsl(var(--primary))]/30 transition-all group ${idx === 0 ? 'bg-[hsl(var(--muted))]' : 'bg-[hsl(var(--card))]'}">
                    <div class="flex items-start gap-3">
                        <div class="w-7 h-7 rounded-md bg-[hsl(var(--primary))]/10 text-[hsl(var(--primary))] flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">
                            ${slide.number}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-medium text-sm text-[hsl(var(--foreground))] truncate mb-0.5">${slide.title}</h4>
                            <p class="text-xs text-[hsl(var(--muted-foreground))] truncate">${slide.content.substring(0, 60)}...</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function selectSlide(index) {
            document.querySelectorAll('.slide-item').forEach((el, i) => {
                if (i === index) {
                    el.classList.add('bg-[hsl(var(--muted))]', 'border-[hsl(var(--primary))]/30');
                    el.classList.remove('bg-[hsl(var(--card))]');
                } else {
                    el.classList.remove('bg-[hsl(var(--muted))]', 'border-[hsl(var(--primary))]/30');
                    el.classList.add('bg-[hsl(var(--card))]');
                }
            });
        }

        async function generateNotes() {
            if (slidesData.length === 0) return;
            
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            document.getElementById('statusBar').style.transform = 'translateY(0)';
            document.getElementById('editorLoading').classList.remove('hidden');
            
            const editor = document.getElementById('notesEditor');
            let notes = `# ${originalFileName}\n\n`;
            notes += `> **Generated:** ${new Date().toLocaleDateString()} | **Source:** ${slidesData.length} sections\n\n---\n\n`;
            notes += `## Contents\n\n`;
            slidesData.forEach(s => notes += `${s.number}. ${s.title}\n`);
            notes += `\n---\n\n`;

            for (let i = 0; i < slidesData.length; i++) {
                document.getElementById('progressFill').style.width = `${((i+1)/slidesData.length)*100}%`;
                
                const slide = slidesData[i];
                notes += `## ${slide.number}. ${slide.title}\n\n`;
                
                const sentences = slide.content.match(/[^.!?]+[.!?]+/g) || [slide.content];
                const bullets = sentences.slice(0, 4).map(s => s.trim()).filter(s => s.length > 10);
                
                if (bullets.length) {
                    notes += `### Key Points\n\n`;
                    bullets.forEach((b, idx) => notes += `${idx+1}. ${b}\n`);
                    notes += `\n`;
                }
                
                notes += `---\n\n`;
                editor.value = notes;
                updateWordCount();
                await new Promise(r => setTimeout(r, 50));
            }

            notes += `## Summary\n\nReview all ${slidesData.length} sections above. Focus on understanding the key concepts and definitions extracted from the source material.`;
            
            editor.value = notes;
            updateWordCount();
            document.getElementById('downloadBtn').disabled = false;
            document.getElementById('downloadBtn').classList.remove('opacity-50', 'cursor-not-allowed');
            
            setTimeout(() => {
                document.getElementById('statusBar').style.transform = 'translateY(-100%)';
                document.getElementById('editorLoading').classList.add('hidden');
                btn.disabled = false;
                lucide.createIcons();
            }, 500);
        }

        function setMode(mode) {
            const editBtn = document.getElementById('editBtn');
            const previewBtn = document.getElementById('previewBtn');
            const editor = document.getElementById('notesEditor');
            const preview = document.getElementById('notesPreview');
            
            if (mode === 'edit') {
                editor.classList.remove('hidden');
                preview.classList.add('hidden');
                editBtn.classList.add('bg-[hsl(var(--background))]', 'shadow-sm', 'text-[hsl(var(--foreground))]');
                editBtn.classList.remove('text-[hsl(var(--muted-foreground))]');
                previewBtn.classList.remove('bg-[hsl(var(--background))]', 'shadow-sm', 'text-[hsl(var(--foreground))]');
                previewBtn.classList.add('text-[hsl(var(--muted-foreground))]');
            } else {
                editor.classList.add('hidden');
                preview.classList.remove('hidden');
                updatePreview();
                previewBtn.classList.add('bg-[hsl(var(--background))]', 'shadow-sm', 'text-[hsl(var(--foreground))]');
                previewBtn.classList.remove('text-[hsl(var(--muted-foreground))]');
                editBtn.classList.remove('bg-[hsl(var(--background))]', 'shadow-sm', 'text-[hsl(var(--foreground))]');
                editBtn.classList.add('text-[hsl(var(--muted-foreground))]');
            }
        }

        function updatePreview() {
            let md = document.getElementById('notesEditor').value;
            md = md
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>')
                .replace(/---/g, '<hr>')
                .replace(/^\d+\.(.*$)/gm, '<li>$1</li>');
            
            const lines = md.split('\n');
            let inList = false;
            let html = [];
            
            lines.forEach(line => {
                if (line.startsWith('<li>')) {
                    if (!inList) {
                        html.push('<ol>');
                        inList = true;
                    }
                    html.push(line);
                } else {
                    if (inList) {
                        html.push('</ol>');
                        inList = false;
                    }
                    if (line.trim() && !line.startsWith('<')) {
                        html.push(`<p>${line}</p>`);
                    } else {
                        html.push(line);
                    }
                }
            });
            if (inList) html.push('</ol>');
            
            document.getElementById('notesPreview').innerHTML = html.join('');
        }

        function updateWordCount() {
            const text = document.getElementById('notesEditor').value;
            const count = text.trim() ? text.trim().split(/\s+/).length : 0;
            document.getElementById('wordCount').innerHTML = `
                <span class="w-1.5 h-1.5 rounded-full bg-green-500 ${count > 0 ? 'animate-pulse' : ''}"></span>
                ${count.toLocaleString()} words
            `;
        }

        function copyContent() {
            const content = document.getElementById('notesEditor').value;
            navigator.clipboard.writeText(content).then(() => showToast('Copied', 'Content copied to clipboard', 'success'));
        }

        function downloadMarkdown() {
            const content = document.getElementById('notesEditor').value;
            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `notes-${new Date().toISOString().split('T')[0]}.md`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Downloaded', 'Markdown file saved', 'success');
        }

        function downloadPDF() {
            const content = document.getElementById('notesEditor').value;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html class="dark">
                <head>
                    <title>UniNotes - ${originalFileName}</title>
                    <script src="https://cdn.tailwindcss.com"><\/script>
                    <style>
                        body { font-family: 'Inter', sans-serif; line-height: 1.6; max-width: 800px; margin: 40px auto; padding: 20px; background: white; color: #111; }
                        h1 { font-size: 24px; font-weight: 700; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
                        h2 { font-size: 18px; font-weight: 600; margin-top: 24px; color: #333; }
                        h3 { font-size: 16px; font-weight: 600; margin-top: 16px; }
                        ol { margin-left: 20px; }
                        li { margin-bottom: 6px; }
                        strong { color: #059669; }
                        blockquote { border-left: 3px solid #333; padding-left: 12px; color: #666; font-style: italic; margin: 12px 0; }
                    </style>
                </head>
                <body>
                    ${content.replace(/^# (.*$)/gm, '<h1>$1</h1>')
                            .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                            .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                            .replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>')
                            .replace(/---/g, '<hr>')
                            .replace(/^\d+\.(.*$)/gm, '<li>$1</li>')
                            .replace(/\n\n/g, '</p><p>')}
                </body>
                </html>
            `);
            setTimeout(() => {
                printWindow.focus();
                printWindow.print();
            }, 250);
        }

        function showToast(title, message, type = 'info') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const titleEl = document.getElementById('toastTitle');
            const msgEl = document.getElementById('toastMessage');
            
            const colors = {
                error: 'text-red-500',
                success: 'text-green-500',
                info: 'text-blue-500'
            };
            
            const icons = {
                error: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" x2="9" y1="9" y2="15"/><line x1="9" x2="15" y1="9" y2="15"/></svg>',
                success: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>',
                info: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>'
            };
            
            icon.innerHTML = icons[type];
            icon.className = colors[type];
            titleEl.textContent = title;
            msgEl.textContent = message;
            
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => {
                    toast.classList.add('hidden');
                    toast.classList.remove('hiding');
                }, 300);
            }, 4000);
        }

        function togglePanel(btn) {
            const panel = btn.closest('.card').querySelector('.overflow-y-auto');
            const icon = btn.querySelector('svg');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                icon.style.transform = 'rotate(0deg)';
            } else {
                panel.style.display = 'none';
                icon.style.transform = 'rotate(-90deg)';
            }
        }

        function resetApp() {
            document.getElementById('workspace').classList.add('hidden');
            document.getElementById('uploadSection').classList.remove('hidden');
            document.getElementById('notesEditor').value = '';
            document.getElementById('extractionLog').innerHTML = '';
            document.getElementById('extractionLog').classList.add('hidden');
            document.getElementById('downloadBtn').disabled = true;
            document.getElementById('downloadBtn').classList.add('opacity-50', 'cursor-not-allowed');
            slidesData = [];
            updateWordCount();
        }

        document.getElementById('notesEditor').addEventListener('input', () => {
            updateWordCount();
            if (!document.getElementById('notesPreview').classList.contains('hidden')) {
                updatePreview();
            }
        });
    </script>
</body>
</html>